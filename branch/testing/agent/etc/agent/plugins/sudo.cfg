;; sudo
;; plugin_id: 4005
;; type: detector 
;; description: Sudo allows users to run programs with the security privileges of another user (normally the system's superuser) in a secure manner
;;              
;; URL: http://www.sudo.ws
;;

[DEFAULT]
plugin_id=4005

[config]
type=detector
enable=yes

source=log
location=/var/log/auth.log

# create log file if it does not exists, 
# otherwise stop processing this plugin
create_file=false

process=
start=no   
stop=no
startup=
shutdown=

[translation]
FAILED=1
Successful=2

## rules

[01 - sudo - Status Failed/Sucessful]
#Sep  6 12:07:26 ossim-devel su[9886]: FAILED su for root by juanma
#Sep  6 12:10:05 ossim-devel su[9978]: Successful su for root by juanma
event_type=event
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?P<dst>\S+).*?su.*?(?P<status>\S+)\s+su for root by (?P<user>\S+)"
date={normalize_date($date)}
plugin_sid={translate($status)}
dst_ip={resolv($dst)}
username={$user}

[02 - sudo - Successful su - freebsd]
#Aug  7 00:23:20 ips01 su: user1 to root on /dev/ttyp0
event_type=event
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?P<dst>\S+).*?su: (?P<user>\S+) to root.*"
date={normalize_date($date)}
plugin_sid=2
dst_ip={resolv($dst)}
username={$user}

[03 - sudo - Command executed]
#Sep 11 09:26:17 ossim-devel sudo:     dgil : TTY=pts/3 ; PWD=/tmp ; USER=root; COMMAND=/usr/bin/dpkg -i acidbase_1.2.6-1ossim1_all.deb
event_type=event
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?P<dst>\S+).*sudo:\s+(?P<user>\S+).*TTY=(?P<tty>\S+).*PWD=(?P<pwd>\S+).*USER=(?P<user2>\S+);.*COMMAND=(?P<command>.*)"
date={normalize_date($date)}
plugin_sid=3
dst_ip={resolv($dst)}
username={$user}
userdata1={$user2}
userdata2={$pwd}
userdata3={$command}

[04 - sudo - User not in sudoers]
#Jan 25 19:23:01 10.11.6.12 sudo:   espinete : user NOT in sudoers ; TTY=pts/3; PWD=/ ; USER=root ; COMMAND=/bin/rm
event_type=event
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?P<dst>\S+).*?sudo:\s+(?P<user>\S+).*user NOT in sudoers.*TTY=(?P<tty>\S+);.*PWD=(?P<pwd>\S+).*USER=(?P<user2>\S+).*COMMAND=(?P<command>\S+)"
date={normalize_date($date)}
plugin_sid=4
dst_ip={resolv($dst)}
username={$user}
userdata1={$pwd}
userdata2={$command}
userdata3={$user2}
