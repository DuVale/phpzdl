; plugin_name: snare
; type: detector
; plugin_id: 1518
;

[DEFAULT]
plugin_id=1518

[config]
type=detector
enable=yes

process=rsyslogd
start=no    ; launch plugin process when agent starts
stop=no     ; shutdown plugin process when agent stops
startup=/etc/init.d/rsyslog start
shutdown=/etc/init.d/rsyslog stop

source=log
location=/var/log/snare.log

# create log file if it does not exists,
# otherwise stop processing this plugin
create_file=false

[Snare - Application/System]
#Mar 18 07:12:21 test.com MSWinEventLog;1;Application;239723;Fri Mar 18 07:12:21 2011;5;CiscoAAA;Unknown User;N/A;Information;test;None;;Outbound replication cycle starting...;

#Jul 15 13:55:01 test.com#011MSWinEventLog#0111#011System#0113#011Fri Jul 15 13:55:01 2011#0117035#011Service Control Manager#011johndoe#011User#011Information#011LAP054830#011None#011#011The Snare service was successfully sent a start control.  #0112
event_type=event
regexp="(?P<date>\w+ \d{1,2} \d{1,2}:\d{1,2}:\d{1,2}) (?P<host>\S+)(#011|\s)MSWinEventLog(#011|;)\d+(#011|;)(?P<type>\w+)(#011|;)\d+(#011|;)(?P<date_event>\w{3} \w{3} \d{2} \d{1,2}:\d{1,2}:\d{1,2} \d{4})(#011|;)(?P<sid>\d+)(#011|;)(?P<msg>.*)(#011|;)(?P<user>.*)(#011|;).*(#011|;)(?P<type_2>\w+)(#011|;)(?P<hostname>.*)(#011|;).*(#011|;)(#011|;)(?P<msg_event>.*)(#011|;)"
date={normalize_date($date_event)}
plugin_id=1518
plugin_sid={$sid}
src_ip={resolv($host)}
username={$user}
userdata1={$hostname}
userdata1={$type_2}
userdata2={$type}
userdata3={$msg}
userdata4={$msg_event}

[Snare - Security]
#Mar 18 06:43:32 test.com MSWinEventLog;1;Security;41982413;Fri Mar 18 06:43:27 2011;680;Security;john.doe;User;Success Audit;test;Account Logon  ;;Logon attempt by:	MICROSOFT_AUTHENTICATION_PACKAGE_V1_0    Logon account:	john.doe    Source Workstation:	test Error Code:	0x0    ;Line 39158: Mar 18 06:43:32 test.com MSWinEventLog;1;Security;41982413;Fri Mar 18 06:43:27 2011;680;Security;test.com;User;Success Audit;test;Account Logon  ;;Logon attempt by:	MICROSOFT_AUTHENTICATION_PACKAGE_V1_0    Logon account:	john.doe Source Workstation:	ADD2HD392    Error Code:	0x0    ;41979108
event_type=event
regexp="^(?P<date>\w+ \d{1,2} \d{1,2}:\d{1,2}:\d{1,2}) (?P<host>\S+)(#011|\s)MSWinEventLog(;|#011)\d+(;|#011)(?P<type>\w+)(;|#011)\d+(;|#011)(?P<date_event>\w{3} \w{3} \d{2} \d{1,2}:\d{1,2}:\d{1,2} \d{4})(#011|;)(?P<sid>\d+)(;|#011)(?P<msg>[^;#011]+)(;|#011)(?P<user>[^#;]+)(;|#011)[^#;]+(;|#011)(?P<type_2>[^#;]+)(;|#011)[^#;]+(;|#011)(?P<msg_2>[^#;]+)(;|#011)(;|#011)(?P<msg_3>[^:]+):"
date={normalize_date($date_event)}
plugin_id=1518
plugin_sid={$sid}
src_ip={resolv($host)}
src_ip={resolv($host)}
username={$user}
userdata1={$type_2}
userdata2={$msg}
userdata3={$msg_2}
userdata4={$msg_3}

[Snare -zzz- Generic Rule]
event_type=event
regexp="^(?P<date>\w+ \d{1,2} \d{1,2}:\d{1,2}:\d{1,2}) (?P<host>\S+)(#011|\s)MSWinEventLog(;|#011)\d+(;|#011)(?P<type>\w+)(;|#011)\d+(;|#011)(?P<date_event>\w{3} \w{3} \d{2} \d{1,2}:\d{1,2}:\d{1,2} \d{4})(#011|;)(?P<sid>\d+)(;|#011)(?P<msg>[^;#011]+)(;|#011)(?P<user>[^#;]+)"
date={normalize_date($date_event)}
plugin_id=1518
plugin_sid={$sid}
src_ip={resolv($host)}
username={$user}
userdata1={$type}
userdata2={$msg}
