;; cisco-pix
;; plugin_id: 1514
;; 
;; $Id: cisco-pix.cfg,v x.x 2011/10/13 21:29:00 mramos Exp $
;;
;; Plugin also tested with:      http://www.ossec.net/wiki/index.php/Cisco_PIX
;;
;; The order rules are defined matters.
;;

[DEFAULT]
plugin_id=1514

[config]
type=detector
enable=yes

source=log
location=/var/log/cisco.log
create_file=false

process=
start=no
stop=no
startup=
shutdown=

[AAA - cisco-pix]
#In this type of log the second IP is the source and the first one the destination
#Oct 3 18:18:41 192.168.11.32 %PIX-6-302015: Built outbound UDP connection 53925644 for outside:192.168.11.33/53 (192.168.11.33/53) to inside:192.168.110.33/16896 (192.168.110.33/16896)
#Oct 3 18:18:42 192.168.10.33 %PIX-6-302013: Built outbound TCP connection 10574437 for outside:192.168.10.23/80 (192.168.10.23/80) to inside:192.168.10.254/60835 (192.168.10.33/19698)

regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>Built\s+outbound\s+(?P<proto>\S+)(.+)?for(\s+\S+)+:(?P<dst>[^\s|^/]+)(\/(?P<dport>\S+))?(.+)?to(\s+\S+){1,2}:(?P<src>[^\s|^/]+)(\/(?P<sport>\S+))?(.+)?)"

event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={resolv($src)}
src_port={$sport}
dst_ip={resolv($dst)}
dst_port={$dport}
protocol={$proto}

[AAB - cisco-pix]
#Oct  3 18:18:46 192.168.1.12 %PIX-6-302014: Teardown TCP connection 10574102 for outside:172.16.92.12/11914 to inside:1g/80 duration 0:01:02 bytes 1233TCP FINs
#Oct  3 18:18:46 192.168.1.10 %PIX-6-302014: Teardown TCP connection 698593747 for interges:TASA_NW_111/44059 to dmzCorporativa:10.244.179.16/6000 duration 0:00:00 bytes 37128 TCP FINs
#Oct  3 18:18:44 192.168.1.10 %PIX-6-302016: Teardown UDP connection 698585414 for getotal:172.16.92.12/11914/161 to dmzgetion10:NAGIOSCGP/56590 duration 0:01:03 bytes 995
#Oct  3 18:18:44 192.168.1.10 %PIX-6-302016: Teardown UDP connection 698585426 for tmn:CONCORD2/162 to redgestion:172.16.92.12/161 duration 0:01:03 bytes 549
#Oct  3 18:18:42 192.168.1.12 %PIX-6-302013: Built inbound TCP connection 10574436 for outside:200.70.14.152/1957 (200.70.14.152/1957) to inside:1g/80 (200.51.47.193/80)
#Oct  3 18:18:42 192.168.1.12 %PIX-6-302013: Built outbound TCP connection 10574437 for outside:200.43.15.16/80 (200.43.15.16/80) to inside:1g/60835 (192.168.1.12/19698)
#Oct  3 18:18:40 192.168.1.12 %PIX-6-302015: Built inbound UDP connection 10574427 for outside:172.16.54.20/52538 (172.16.54.20/52538) to inside:172.16.1.11/53 (172.16.1.11/53)
#Oct  3 18:18:40 192.168.1.12 %PIX-6-302015: Built inbound UDP connection 10574427 for outside:172.16.54.20/52538 (172.16.54.20/52538) to inside:172.16.1.11/53 (172.16.1.11/53)
#Oct  3 18:18:41 192.168.10.11 %PIX-6-302015: Built outbound UDP connection 53925644 for outside:200.0.243.11/53 (200.0.243.11/53) to inside:200.70.24.206/16896 (200.70.24.206/16896)
#Oct  3 18:18:46 192.168.1.10 %PIX-4-106023: Deny udp src outside:200.26.76.22/49859 dst inside:leeloo/162 by access-group "2" [0x0, 0x0]
#Oct  3 18:18:46 192.168.1.10 %PIX-4-106023: Deny udp src getotal:CORZOW/137 dst getotal:192.168.112.1/137 by access-group "getotal" [0x0, 0x0]
#Oct  3 18:18:41 192.168.1.10 %PIX-4-106023: Deny tcp src getotal:192.168.252.33/22085 dst redgestion:172.31.200.91/1025 by access-group "getotal" [0x0, 0x0]
#Oct  3 18:18:41 192.168.1.10 %PIX-4-106023: Deny tcp src outside:87.111.0.172/3286 dst outside:TEST/54901 by access-group "2" [0x0, 0x0]

#Oct  3 18:18:40 192.168.1.10 %PIX-4-106023: Deny icmp src getotal:10.30.200.71 dst getotal:192.168.32.10 (type 0, code 0) by access-group "getotal" [0x0, 0x0]
#Oct  3 18:18:40 192.168.1.10 %PIX-4-106023: Deny icmp src outside:200.26.75.194 dst tmn:pool-gestion (type 3, code 1) by access-group "2" [0x0, 0x0]
#Jan 28 06:17:47 pix-inside %PIX-3-106010: Deny inbound icmp src outside:80.181.210.80 dst inside:10.10.97.229 (type 8, code 0)
#Jan 28 00:21:50 pix-inside %PIX-3-106011: Deny inbound (No xlate) tcp src outside:182.12.12.12/1233 dst outside:10.47.243.45/80
#Oct  3 18:18:44 192.168.1.10 %PIX-3-305005: No translation group found for udp src getotal:192.168.100.254/161 dst dmzgetion10:MOTOROLA/162
#Oct  3 18:18:41 192.168.1.10 %PIX-4-313005: No matching connection for ICMP error message: icmp src dmzCorporativa:ZAPATAS dst getotal:192.168.142.76 (type 3, code 3) on dmzCorporativa interface.  Original IP payload: udp src 192.168.142.76/52777 dst ZAPATAS/9996.
#Sep  7 06:25:28 PIXName %PIX-6-302013: Built inbound TCP connection 141968 for db:10.0.0.1/60749 (10.0.0.1/60749) to NP Identity Ifc:10.0.0.2/22 (10.0.0.2/22)
#%PIX-3-305006: portmap translation creation failed for tcp src inside:192.168.1.2/2892 dst outside:192.168.2.99/3128
#%PIX-3-106011: Deny inbound (No xlate) udp src outside:192.168.2.1/137 dst outside:192.168.2.14/137
#%PIX-3-106010: Deny inbound tcp src outside:192.168.1.10/2620 dst dmz:192.168.11.11/135
#Jan 28 01:48:01 pix-inside %PIX-4-106023: Deny protocol 4 src outside:192.168.11.12 dst inside:10.10.17.135 by access-group "ACL-FROM-OUTSIDE"
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>.+?(for?|src?)(\s+\S+)+:(?P<src>[^\s|^/]+)(\/(?P<sport>\S+))?.+?(to?|dst?)(\s+\S+){1,2}:(?P<dst>[^\s|^/]+)(\/(?P<dport>\S+))?(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
src_port={$sport}
dst_ip={resolv($dst)}
dst_port={$dport}

[AAC - cisco-pix]
#Oct  3 18:18:40 192.168.1.10 %PIX-4-313004: Denied ICMP type=0, from laddr 192.168.137.101 on interface getotal to 172.31.10.80: no matching session

regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>Denied.+?from\s+(\S+\s+)?(?P<src>\S+)\s+on interface (?P<interface>\S+) to (?P<dst>\S+)[:|](.+)?)"

event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={resolv($src)}
dst_ip={resolv($dst)}
userdata1={$interface}

[AAD - cisco-asa]
#Oct 20 14:48:29 2.0.24.129 %PIX-2-106006: Deny inbound UDP from 2.1.13.27/64847 to 192.168.1.2/31234 on interface WIFI
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>Deny(.+)?from\s+(?P<src>\S[^/]+)(/(?P<sport>\S+))\s+to\s+(?P<dst>\S[^/]+)(/(?P<dport>\S+))\s+on\s+interface\s+(?P<iface>\S+)(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
dst_ip={resolv($dst)}
interface={$iface}

[AAE - cisco-pix]
#Oct  3 18:18:42 192.168.1.10 %PIX-2-106016: Deny IP spoof from (192.168.1.20) to 0.0.0.0 on interface WIFI

regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>Deny.+?from\s+(\()?(?P<src>\S[^)]+)((\)))?(\s+)?to\s+(?P<dst>\S+)\s+on\s+interface\s+(?P<interface>\S+)(.+)?)"

event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
dst_ip={resolv($dst)}
userdata1={$interface}

[AAF - cisco-asa]
#Oct 20 08:41:54 2.1.44.202 %PIX-4-402117: IPSEC: Received a non-IPSec packet (protocol= ICMP) from 20.1.7.193 to 172.16.12.10.
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>(.+)?IPSEC(.+)?protocol=(\s+)?(?P<proto>\S[^)]+)(.+)?from\s+(?P<src>\S+)\s+to\s+(?P<dst>\S+)(\.)(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
dst_ip={resolv($dst)}
interface={$iface}
protocol={$proto}

[AAG - cisco-pix]
#Oct  3 18:18:41 192.168.1.12 %PIX-6-305012: Teardown dynamic TCP translation from inside:1g/60788 to outside:192.168.1.12/19692 duration 0:00:30
#Oct  3 18:18:43 192.168.1.10 %PIX-6-305012: Teardown dynamic UDP translation from WIFI:192.168.1.24/500 to outside:LA_PROLE/374 duration 0:02:46
#Oct  3 18:18:45 192.168.1.10 %PIX-6-305012: Teardown dynamic UDP translation from redgestion:172.16.115.15/34069 to getotal(redgestion_nat_outbound_1):172.31.10.80/8708 duration 0:03:45
#Oct  3 18:18:41 192.168.1.10 %PIX-6-305012: Teardown dynamic ICMP translation from dmzCorporativa:10.10.10.249/50946 to outside(dmzCorporativa_nat_outbound):pool-gestion/19214 duration 0:00:32
#Oct  3 18:18:41 192.168.1.12 %PIX-6-302021: Teardown ICMP connection for faddr 172.16.9.1/4352 gaddr 192.168.1.12/0 laddr 192.168.1.12/0
#Oct  3 18:18:42 192.168.1.12 %PIX-6-305011: Built dynamic TCP translation from inside:1g/60835 to outside:192.168.1.12/19698
#Oct  3 18:18:44 192.168.1.12 %PIX-6-305011: Built dynamic UDP translation from inside:172.16.1.11/51061 to outside:192.168.1.12/43246
#Oct  3 18:18:40 192.168.1.12 %PIX-6-302020: Built ICMP connection for faddr 172.16.9.1/4352 gaddr 192.168.1.12/0 laddr 192.168.1.12/0
#Oct  3 18:18:41 192.168.1.10 %PIX-6-106015: Deny TCP (no connection) from 172.31.200.91/1025 to 192.168.252.33/22085 flags RST ACK  on interface getotal
#Oct  3 18:18:42 192.168.1.10 %PIX-6-106015: Deny TCP (no connection) from 192.168.11.11/443 to pool-gestion/19063 flags RST  on interface outside
#Oct  3 18:18:41 192.168.1.10 %PIX-4-419002: Duplicate TCP SYN from dmzCorporativa:10.10.10.250/1463 to redgestion:172.16.204.137/1270 with different initial sequence number
#Oct  3 18:18:41 200.70.55.214 %PIX-7-710005: UDP request discarded from 192.168.13.140/3205 to inside:255.255.255.255/3206
#Oct  9 13:11:13 192.168.1.10 %PIX-6-110003: Routing failed to locate next hop for TCP from protected:TEST2000/49 to getotal:192.168.1.50/27272
#Sep  7 06:25:28 PIXName %PIX-7-710002: TCP access permitted from 10.0.0.1/60749 to db:10.0.0.2/ssh
#regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>.+?(faddr|from)\s+(\S+:)?(?P<src>\S[^/]+)(\/(?P<sport>\S+))?.+(gaddr|to)\s+(\S+:)?(?P<dst>\S[^/]+)(\/(?P<dport>\S+))?(.+)?)"
#Sep  7 06:31:32 PIXName %PIX-6-315011: SSH session from 10.0.0.254 on interface db for user "" disconnected by SSH server, reason: "TCP connection closed" (0x03)
#%PIX-6-315011: SSH session from 192.168.2.10 on interface outside for user "root" disconnected by SSH server, reason: "TCP connection closed" (0x03)
#%PIX-7-710001: TCP access requested from 192.168.2.10/13269 to outside:192.168.2.14/ssh
#%PIX-6-605004: Login denied from 192.168.2.10/13269 to outside:192.168.2.14/ssh for user "root"
#Jul 05 2004 00:58:00: %PIX-4-400011: IDS:2001 ICMP unreachable from 172.16.34.19 to 192.168.54.23 on interface outside
#Jul 05 2004 00:56:26: %PIX-4-500004: Invalid transport field for protocol=17, from 10.10.56.199/50230 to 192.168.65.23/0
#Dec 05 2006 12:06:59: %PIX-4-405001: Received ARP request collision from 10.10.101.220/007e.0cfe.b3a4 on interface inside
#Oct 12 19:38:46 192.168.1.10 %PIX-6-303002: FTP connection from dmzCorporativa:CORZOW/3997 to outside:172.16.10.10/21, user admin Retrieved file VTS_04_0.VOB
# Oct 20 08:23:43 2.7.57.34 %PIX-6-106012: Deny IP from 1.2.3.4 to 224.0.0.2, IP options: "Router Alert"
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>(.+)?(faddr|from)\s+(\S+:)?(?P<src>\S[^/|\s]+)((\/(?P<sport>\S+))?.+(gaddr|to)\s+(\S+:)?(?P<dst>\S[^/|\s+|,]+)(\/(?P<dport>\S[^,]+)(,)?)?(.+)?)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
src_port={$sport}
dst_ip={resolv($dst)}
dst_port={$dport}

[AAH - cisco-pix]
#Oct  3 18:18:40 192.168.1.10 %PIX-7-609002: Teardown local-host dmzCorporativa:172.16.18.2 duration 0:00:00
#Oct  3 18:18:40 192.168.1.10 %PIX-7-609001: Built local-host dmzCorporativa:172.16.18.2
#Oct 20 12:47:21 2.7.55.214 %PIX-4-407001: Deny traffic for local-host inside:192.168.1.15, license limit of 10 exceeded
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>(.+)?local-host\s+(?P<iface>\S+):(?P<src>\S[^,^\s]+)(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
src_ip={resolv($src)}
interface={$iface}

[AAI - cisco-pix]
#Sep  7 06:26:20 PIXName %PIX-5-304001: 192.168.1.20 Accessed URL 10.0.0.10:/Home/index.cfm
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-(?P<severity>\d+)-(?P<sid>\d+):\s+(?P<userdata>(?P<src>\S+)\s+Accessed\s+URL\s+(?P<dst>\S[^:|\s+]+)(:)?(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={resolv($src)}
dst_ip={$dst}

[AAJ - cisco-pix]
#Oct 12 19:57:46 192.168.1.12 %PIX-3-713902: Group = DefaultL2LGroup, IP = 192.168.1.19, Removing peer from correlator table failed, no match!
#%PIX-6-604101: DHCP client interface outside: Allocated ip = 192.168.2.11, mask = 255.255.255.0, gw = 192.168.2.1
#Oct 12 20:33:40 192.168.1.12 %PIX-3-713902: Group = DefaultL2LGroup, IP = 192.168.12.12, QM FSM error (P2 struct &0x2a3a6a0, mess id 0x683cfe85)!
#Oct 12 20:33:40 192.168.1.12 %PIX-7-715065: Group = DefaultL2LGroup, IP = 192.168.12.12, IKE QM Responder FSM error history (struct &0x2a3a6a0)  <state>, <event>:  QM_DONE, EV_ERROR-->QM_BLD_MSG2, EV_IS_REKEY-->QM_BLD_MSG2, EV_CONFIRM_SA-->QM_BLD_MSG2, EV_PROC_MSG-->QM_BLD_MSG2, EV_HASH_OK-->QM_BLD_MSG2, NullEvent-->QM_BLD_MSG2, EV_COMP_HASH-->QM_BLD_MSG2, EV_VALIDATE_MSG
#Oct 12 20:33:40 192.168.1.12 %PIX-7-713906: Group = DefaultL2LGroup, IP = 192.168.12.12, sending delete/delete with reason message
#Oct 12 20:33:40 192.168.1.12 %PIX-7-713906: Group = DefaultL2LGroup, IP = 192.168.12.12, IKE SA MM:006654df rcv'd Terminate: state MM_ACTIVE  flags 0x00000042, refcnt 1, tuncnt 0
#Oct 12 20:33:40 192.168.1.12 %PIX-7-715046: Group = DefaultL2LGroup, IP = 192.168.12.12, constructing blank hash payload
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-(?P<severity>\d+)-(?P<sid>\d+):\s+(?P<userdata>(.+)?(ip|IP)\s+=\s+(?P<src>\S[^,]+)(,)?(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={resolv($src)}

[AAK - cisco-pix]

#%PIX-6-604103: DHCP daemon interface inside:  address granted 000c.29e4.ebc3 (192.168.1.16)
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-(?P<severity>\d+)-(?P<sid>\d+):\s+(?P<userdata>(.+)?address\s+granted(.+)?\((?P<src>\S[^,|^)]+)(,|\))(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={resolv($src)}

[AAL - cisco-pix]
#Oct  3 18:18:44 192.168.1.10 %PIX-4-733100: [ Scanning] drop rate-1 exceeded. Current burst rate is 10 per second, max configured rate is 10; Current average rate is 79 per second, max configured rate is 5; Cumulative total count is 47421
#Oct 12 07:48:52 192.168.1.11 %PIX-7-111009: User 'enable_1' executed cmd: show
#Oct 12 13:57:49 192.168.1.10 %PIX-7-711002: Task ran for 7 msec, Process = Dispatch Unit, PC = 278149, Traceback =
#Sep  7 06:31:26 PIXName %PIX-7-711002: Task ran for 330 msec, Process= ssh_init, PC = fddd93, Traceback =   0x00FF1E6B  0x00FE1890 0x009CF6B5  0x00BDB9CE  0x00BDA502
#%PIX-3-201008: The PIX is disallowing new connections.
#Jul 05 2004 00:56:23: %PIX-2-109011: Authen Session Start: user 'Graffe', sid 55
regexp="((?P<date>\S+\s+\d+\s+\d+:\d+:\d+)\s+(?P<sensor>\S+)\s+)?%\w+-\d-(?P<sid>\d+):\s+(?P<userdata>(.+)?)"
event_type=event
date={normalize_date($date)}
sensor={resolv($sensor)}        
plugin_sid={$sid}
