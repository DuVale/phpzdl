;; netkeeper-fw
;; plugin_id: 1646
;; Jose Luis Dorado
;; 

[DEFAULT]
plugin_id=1646

[config]
type=detector
enable=yes

source=log
location=/var/log/netkeeper-fw.log

# create log file if it does not exists,
# otherwise stop processing this plugin
create_file=false

process=
start=no	; launch plugin process when agent starts
stop=no     ; shutdown plugin process when agent stops
#startup=/etc/init.d/%(process)s start
#shutdown=/etc/init.d/%(process)s stop
restart=yes  ; restart plugin process after each interval
restart_interval=\_CFG(watchdog,restart_interval) ; interval between each restart


# list of sids (comma separated) to be excluded by the detector
#exclude_sids=200,302,404,403

[translation]
t_ipftraffic=1
t_nettraffic=2
t_aclallow=3
t_cfg_change=4
t_geninfo=5
t_netprobe=6
t_servtraffic=7
t_lcm=8

t_info=100
t_geninfo=100
_DEFAULT_=100


[00 - Netkeeper Firewall IP traffic event]

# Jun  9 13:55:04 fw005 auditd: date="Jun  9 05:55:04 2011 UTC",fac=f_kernel_ipfilter,area=a_general_area,type=t_ipftraffic,pri=p_major,pid=0,ruid=0,euid=0,pgid=0,logid=0,cmd=kernel,domain=htpp,edomain=htpp,hostname=fw005.mof.gov.tw,event=IP Filter session open,rule_name=I_TO_E_MOF_LAN_ALL_ANY,srcip=172.23.28.16,srcport=2821,srcburb=internal,dstip=61.63.15.166,dstport=80,dstburb=external,protocol=6,netsessid=4df0603800035e72

event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\w+)\s+auditd:.+type=t_ipftraffic.+event=(?P<event>.+),rule_name=(?P<rule_name>.+),srcip=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),srcport=(?P<src_port>\d+).+dstip=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),dstport=(?P<dst_port>\d+).+protocol=(?P<proto>\d+)

plugin_sid=1
date={normalize_date($date)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
src_port={$src_port}
dst_ip={resolv($dst_ip)}
dst_port={$dst_port}
userdate1=Event: {$event}
userdata2=Rule: {$rule_name}
protocol={$proto}


[01 - Netkeeper Firewall info event]

# Jun  9 13:55:24 fw005 auditd: date="Jun  9 05:55:24 2011 UTC",fac=f_kernel_ipfilter,area=a_general_area,type=t_info,pri=p_major,pid=0,ruid=0,euid=0,pgid=0,logid=0,cmd=kernel,domain=htpp,edomain=htpp,hostname=fw005.mof.gov.tw,rule_name=I_TO_E_SOC_LOG,srcip=210.69.109.81,srcport=60490,dstip=211.79.204.85,dstport=8443,protocol=6,information="=IP Filter: Expected SYN, got FIN-ACK"
event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\w+)\s+auditd:.+type=t_info.+rule_name=(?P<rule_name>.+),srcip=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),srcport=(?P<src_port>\d+).+dstip=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),dstport=(?P<dst_port>\d+).+protocol=(?P<proto>\d+),information=(?P<event>.+)

plugin_sid=100
date={normalize_date($date)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
src_port={$src_port}
dst_ip={resolv($dst_ip)}
dst_port={$dst_port}
userdate1=Info: {$event}
userdata2=Rule: {$rule_name}
protocol={$proto}


[02 - Netkeeper Firewall NET traffic event]

# Jun  9 13:55:24 fw005 auditd: date="Jun  9 05:55:24 2011 UTC",fac=f_http_proxy,area=a_libproxycommon,type=t_nettraffic,pri=p_major,pid=2003,ruid=0,euid=0,pgid=2003,logid=0,cmd=httpp,domain=htpp,edomain=htpp,hostname=fw005.mof.gov.tw,event=proxy traffic end,service_name=http,netsessid=4df0600800017335,srcip=60.251.133.50,srcport=57144,srcburb=external,protocol=6,dstip=210.69.109.33,dstport=80,dstburb=internal,bytes_written_to_client=65887,bytes_written_to_server=8161,rule_name=E_TO_I_WEB_SERVER,cache_hit=0,request_status=0,start_time="Thu Jun  9 13:54:16 2011"

event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\w+)\s+auditd:.+type=t_nettraffic.+event=(?P<event>[^,]+).+srcip=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),srcport=(?P<src_port>\d+).+protocol=(?P<proto>\d+),dstip=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),dstport=(?P<dst_port>\d+).+rule_name=(?P<rule_name>[^,]+)

plugin_sid=2
date={normalize_date($date)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
src_port={$src_port}
dst_ip={resolv($dst_ip)}
dst_port={$dst_port}
userdate1=Event: {$event}
userdata2=Rule: {$rule_name}
protocol={$proto}

[03 - Netkeeper Firewall ACL allowed traffic]

# Jun  9 13:55:24 fw005 auditd: date="Jun  9 05:55:24 2011 UTC",fac=f_http_proxy,area=a_proxy,type=t_aclallow,pri=p_major,pid=2002,ruid=0,euid=0,pgid=2002,logid=0,cmd=httpp,domain=htpp,edomain=htpp,hostname=fw005.mof.gov.tw,event=ACL allow,srcip=60.251.34.90,srcport=45426,srcburb=external,dstip=210.69.109.14,dstport=80,dstburb=internal,protocol=6,service_name=http,user_name=(null),auth_method=(null),rule_name=E_TO_I_WEB_SERVER,cache_hit=0,reason="Traffic allowed by policy."

event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\w+)\s+auditd:.+type=t_aclallow.+event=(?P<event>[^,]+).+srcip=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),srcport=(?P<src_port>\d+).+dstip=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}),dstport=(?P<dst_port>\d+).+protocol=(?P<proto>\d+).+rule_name=(?P<rule_name>[^,]+)

plugin_sid=3
date={normalize_date($date)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
src_port={$src_port}
dst_ip={resolv($dst_ip)}
dst_port={$dst_port}
userdate1=Event: {$event}
userdata2=Rule: {$rule_name}
protocol={$proto}


[04 - Netkeeper Firewall event]

event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\w+)\s+auditd:.+type=(?P<type>\w+).+(srcip=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).+|srcport=(?P<src_port>\d+).+|dstip=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).+|dstport=(?P<dst_port>\d+).+|protocol=(?P<proto>\d+))*

plugin_sid={translate($type)}
date={normalize_date($date)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
src_port={$src_port}
dst_ip={resolv($dst_ip)}
dst_port={$dst_port}
protocol={$proto}
