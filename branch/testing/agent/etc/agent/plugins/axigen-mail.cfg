;; axigen-mail
;; plugin_id: 1664
;; type: detector 
;; description: Axigen Email Server

[DEFAULT]
plugin_id=1664

# default values for dst_ip and dst_port
# they can be overwritten in each rule

[config]
type=detector
enable=yes

source=log
location=/var/log/axigen-email.log

# create log file if it does not exists, 
# otherwise stop processing this plugin
create_file=false

process=
start=no   
stop=no
startup=
shutdown=

#exclude_sids=99

[translation]
00=0
01=1
02=2
04=3
08=4
16=5

[100 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:42 +0200 08 ubserver1 CLI:00000001: [127.0.0.1:7000] connection accepted from [127.0.0.1:38968]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:42 +0200 08 ubserver1 CLI:00000001: Login successful: admin-user 'admin'(id=0x00000000) from 127.0.0.1:38968
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:42 +0200 08 ubserver1 CLI:00000001: Success: create domain eff.local
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:42 +0200 08 ubserver1 CLI:00000001: Success: update WEBADMIN service configuration
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:42 +0200 08 ubserver1 CLI:00000001: Success: Listener-level Flow Control configuration updated for listener '0.0.0.0:9000' o
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+(\d+)\s+(\w+)\s+CLI:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=1
src_ip={resolv($3)}
userdata1={$3}
userdata2={$4}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[200 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:22:31 +0200 08 ubserver1 DNR:001C8CF6: Search MX for 'mail.gmx.net'
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:22:31 +0200 08 ubserver1 DNR:001C8CF6: Sending query (1/1) to 192.168.10.1:53
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:22:31 +0200 08 ubserver1 DNR:001C8CF6: Search NS for 'mail.gmx.net'
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:22:31 +0200 08 ubserver1 DNR:001C8CF6: 'dns.gmx.net' found NS '213.165.64.1'
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:22:31 +0200 08 ubserver1 DNR:001C8CF6: Search A for 'mail.gmx.net'
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+(\d+)\s+(\w+)\s+DNR:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=2
src_ip={resolv($3)}
userdata1={$3}
userdata2={$4}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[300 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:40 +0200 08 ubserver1 PROCESSING:00000000: Queue directory /var/opt/axigen//queue// scan complete: 0 mails found; current queue size: 0
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:14:45 +0200 08 ubserver1 PROCESSING:00000000: Shepherd thread is stopped
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 PROCESSING:003C444F: Start processing mail
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 PROCESSING:003C444F: Start filter <filterDetect-003C444F>
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 PROCESSING:003C444F: Finished filtering mail object 3C444F with filter: <filterDetect-003C444F>
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+PROCESSING:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=3
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[301 - first rule]
# Aug 24 10:03:38 siem-01 AXIGEN: 07-20 23:00:34 -0400 02 SERVER PROCESSING:0039EA1D: Error connecting to socket filter: ClamAV(127.0.0.1:3310)
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 02 ubserver1 PROCESSING:003C444F: Filter AVG(127.0.0.1:55555):[ERROR]: Could not connect to filter
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 02 ubserver1 PROCESSING:002F4616: Error connecting
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 02 ubserver1 PROCESSING:000EE5DC: Filter ClamAV(127.0.0.1:3310):[ERROR]: Could not connect to filter
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 02 ubserver1 PROCESSING:000284E5: Filter SpamAssassin Filter(127.0.0.1:783):[ERROR]: Could not connect to filter
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+02\s+(\w+)\s+PROCESSING:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=23
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[302 - first rule]
# Aug 25 04:01:43 siem-01 AXIGEN: 07-20 21:52:54 -0400 04 SERVER PROCESSING:00309165: Remove mail from queue
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+04\s+(\w+)\s+PROCESSING:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=43
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[400 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 11-18 23:21:55 +0100 08 beta SMTP-OUT:00000090: Relay mail 077A6F: connected to 90.183.38.65
# Aug 25 04:01:42 siem-01 AXIGEN: 11-18 23:21:55 +0100 08 beta SMTP-OUT:00000090: Start sending mail 077A6F
# Aug 25 04:01:42 siem-01 AXIGEN: 11-18 23:21:55 +0100 08 beta SMTP-OUT:00000090: Release mail 077A6F
# Aug 25 04:01:42 siem-01 AXIGEN: 11-18 23:21:56 +0100 08 beta SMTP-OUT:00000090: Data sent for mail 077A6F; server response: 2.6.0 message accepted
# Aug 25 04:01:42 siem-01 AXIGEN: 11-18 23:21:56 +0100 08 beta SMTP-OUT:00000090: Disconnected from 90.183.38.65
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+(\d+)\s+(\w+)\s+SMTP-OUT:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=4
src_ip={resolv($3)}
userdata1={$3}
userdata2={$4}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[403 - first rule]
# Aug 25 04:01:43 siem-01 AXIGEN: 05-19 17:37:22 +0200 04 ubserver1 WEBADMIN:0000000B: stopping the server.
# Aug 25 04:01:43 siem-01 AXIGEN: 07-20 21:39:56 -0400 04 SERVER WEBADMIN:00000001: Login failed: authentication failed for admin-user "admin" from 127.0.0.1:2345
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+04\s+(\w+)\s+WEBADMIN:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=45
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[402 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:20 +0200 08 ubserver1 WEBADMIN:00000001: [192.168.10.251:9000] connection accepted from [192.168.10.98:1084]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 WEBADMIN:00000001: New session 0xC5AEB65F associated with this connection
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 WEBADMIN:00000001: Admin-user "admin" (id=0x00000000): login from 192.168.10.98:1084
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 WEBADMIN:00000001: Filter ClamAV loaded from file /var/opt/axigen/filters/clam-av.afsl
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:15:29 +0200 08 ubserver1 WEBADMIN:00000001: Filter SpamAssassin Filter loaded from file /var/opt/axigen/filters/spamassassin.af
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+WEBADMIN:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=5
userdata1={$2}
src_ip={resolv($2)}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[500 - first rule]
# 11-19 10:12:28 +0100 08 beta WEBMAIL:00003700: [192.168.1.3:3000] connection accepted from [80.102.199.34:20916]
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+WEBMAIL:0*([^:]+):\s+\[(\IPV4):(\PORT)\].*\[(\IPV4):(\PORT)\].*"
date={normalize_date($1)}
plugin_sid=6
src_ip={$6}
src_port={$7}
dst_ip={$4}
dst_port={$5}
userdata1={$2}
userdata2={$3}
userdata3={$6}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[502 - first rule]
# 11-19 10:13:00 +0100 08 beta WEBMAIL:00003700: Account 'test@test.es' has logged in
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+WEBMAIL:0*([^:]+):\s+.*\s+[^\w\.\-\_]*(([\w\.\-\_]+?)@[\w\.\-\_]+)\S*\s+.*"
date={normalize_date($1)}
plugin_sid=6
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
userdata4={$4}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[506 - first rule]
# Aug 25 04:01:43 siem-01 AXIGEN: 07-20 22:55:49 -0400 04 SERVER WEBMAIL:00000084: stopping the server.
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+04\s+(\w+)\s+WEBMAIL:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=46
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[507 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 11-19 01:38:24 +0100 08 beta WEBMAIL:0000358A: connection closed with [67.16.94.2:57993]
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+WEBMAIL:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=6
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[601 - first rule]
# 11-19 10:18:40 +0100 08 beta WEBMAIL:00003700: connection closed with [88.102.199.34:20916]
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+08\s+(\w+)\s+WEBMAIL:0*([^:]+):.*\[(\IPV4):(\PORT)\].*"
date={normalize_date($1)}
plugin_sid=6
src_ip={resolv($4)}
src_port={resolv($5)}
userdata1={$2}
userdata2={$3}
userdata4={$4}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[602 - first rule]
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:30:09 +0200 02 ubserver1 WEBMAIL:00000001: Authentication error for user 'johndoe': Invalid password
# Aug 25 04:01:42 siem-01 AXIGEN: 05-19 17:30:09 +0200 02 ubserver1 WEBMAIL:00000001: Authentication error: Invalid password
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+02\s+(\w+)\s+WEBMAIL:0*([^:]+):.*"
date={normalize_date($1)}
plugin_sid=26
src_ip={resolv($2)}
userdata1={$2}
userdata2={$3}
sensor=\_CFG(plugin-defaults,sensor)
#
#
[990 - generic]
# Aug 24 10:03:38 siem-01 AXIGEN: 07-20 23:21:22 -0400 08 SERVER PROCESSING:000B24CB: Shepherd thread received signal for cleanup
event_type=event
regexp="(\w{3}\s+\d{1,2}\s+\d\d:\d\d:\d\d)\s+.*"
plugin_sid=99
sensor=\_CFG(plugin-defaults,sensor)
date={normalize_date($1)}

