[DEFAULT]
plugin_id=1648

[config]
type=detector
enable=yes

source=log
location=/var/log/dovecot.log

create_file=true

process=
start=no   
stop=no
startup=
shutdown=

[translation]
Login=1
Disconnected=2
Aborted Login=3
Connection closed=4
_DEFAULT_=99

#May 31 15:03:56 210.66.158.231 dovecot: pop3-login: Login: user=<pl34>, method=PLAIN, rip=::ffff:192.168.53.185, lip=::ffff:210.66.158.231
#May 31 15:40:12 210.66.158.231 dovecot: pop3-login: Disconnected: user=<ar21555>, method=PLAIN, rip=::ffff:192.168.21.200, lip=::ffff:210.66.158.2
#May 31 15:40:27 210.66.158.231 dovecot: pop3-login: Disconnected: rip=::ffff:192.168.61.75, lip=::ffff:210.66.158.231
[01 - Dovecot event with source and destination]
event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\s+dovecot:.+(?P<type>Login|Disconnected):.+(user=\<(?P<user>\w+)\>.+)?:(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).+:(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}) 
date={normalize_date($date)}
plugin_sid={translate($type)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
dst_ip={resolv($dst_ip)}
username={$user}

#May 31 15:03:57 210.66.158.231 dovecot: POP3(pl34): Disconnected: Logged out top=0/0, retr=1/1544, del=0/5, size=122698
#May 31 15:40:23 210.66.158.231 dovecot: POP3(a64214): Connection closed top=0/0, retr=1/398139, del=0/61, size=104615170
[02 - Dovecot without Source and Destinantion event]
event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\s+dovecot:.+\((?P<user>\w+)\).+(?P<type>Disconnected|Connection\s+closed) 
date={normalize_date($date)}
plugin_sid={translate($type)}
sensor={resolv($sensor)}
username={$user}


#May 31 15:39:10 210.66.158.231 dovecot: pop3-login: Aborted login (1 authentication attempts): user=<a03131>, method=PLAIN, rip=::ffff:192.168.63.151, lip=::ffff:210.66.158.231
[03 - Dovecot aborted event login]
event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\s+dovecot:.+(?P<type>Aborted login).+(?P<attemps>\d+)\s+authentication attempts.+(user=\<(?P<user>\w+)\>.+)?:(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).+:(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}) 
date={normalize_date($date)}
plugin_sid={translate($type)}
sensor={resolv($sensor)}
src_ip={resolv($src_ip)}
dst_ip={resolv($dst_ip)}
username={$user}

# Jun  3 21:31:13 210.66.158.231 dovecot: POP3(a63188): mbox sync: UID inserted in the middle of mailbox /var/mail/a63188 (116843 > 116771, seq=2, idx_msgs=26)
# Jun  4 08:41:45 210.66.158.231 dovecot: POP3(t483001): Cached message offset 142137668 is invalid for mbox file /var/mail/t483001
# May 31 23:39:28 210.66.158.231 dovecot: child 7974 (pop3) killed with signal 6
[99 - General Dovecot event ]
event_type=event
regexp=(?P<date>\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2})\s+(?P<sensor>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\s+dovecot:(.+\((?P<user>\w+)\))? 
date={normalize_date($date)}
plugin_sid=99
sensor={resolv($sensor)}
username={$user}
